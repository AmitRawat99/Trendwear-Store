import React, { useContext, useEffect, useState } from 'react'
import { Col, Container, Row, Tabs, Tab } from 'react-bootstrap'
import '../../style/product_details.scss'
import mainImg from '../../../public/Images/Woman_Clothes/Kurtas_Kurtis/kaliya-original- (3).webp'
import PostReview from '../../Share/PostReview'
// import womanData from '../../assets/Data/WomanData.json'
// import kidsData from '../../assets/Data/kidsData.json'
import { CartContext } from '../../Context/CartProvider'
// import ProductData from '../UserAllData/ProductData'
import { useNavigate, useParams } from 'react-router-dom'
import { FaPlus } from "react-icons/fa6";
import { FaMinus } from "react-icons/fa";
import Cart_Popup from './Cart_Popup'
import Base_Url from '../../utils/config'


function Product_Details() {
    const navigate = useNavigate()
    const { id } = useParams()
    const { cartItem, addToCart, removeItem } = useContext(CartContext)
    const [showPopup, setShowPopup] = useState(false)
    const { slug, brand } = useParams()
    const [onImg, setOnImg] = useState(null)
    const [productDetails, setProductDetails] = useState([])
    const [select, setSelect] = useState(null)
    const [increaseQty, setIncreaseQty] = useState(1)

    const handleAddToCart = () => {
        addToCart({
            id: productDetails.productId,
            productImg: productDetails.productmainImg,
            productName: productDetails.productName,
            productQty: increaseQty,
            productPrice: productPrice,
        })
        setShowPopup(true)
        setTimeout(() => {
            setShowPopup(false)
        }, 3000);
    }


    const changeOnImg = (img) => {
        setOnImg(img)
    }
    const HandleSize = (size) => {
        setSelect(size)
    }

    useEffect(() => {
        const showDetails = async () => {
            try {
                const response = await fetch(`${Base_Url}/products/show-details/${id}`)

                if (!response) {
                    throw new Error("Network issue")
                }

                const data = await response.json()
                console.log(data);
                

                setProductDetails(data.findOneProduct || data)
                console.log("product data", data.findOneProduct, "data", data);


            } catch (error) {
                console.log("semethink went wrong", error)
            }
        }
        showDetails()
    }, [])

    useEffect(() => {
        console.log("product details", productDetails);
    }, [])



    const increament = () => {
        setIncreaseQty(prev => prev + 1)
        console.log(increaseQty);
    }

    const decreament = () => {
        setIncreaseQty(prev => prev - 1)
        setIncreaseQty(prev => (prev > 1 ? prev - 1 : 1));

    }



    return (
        <>
            <Container>
                <Row>
                    <div className="product_details_page d-flex justify-between   mt-5" >

                        {showPopup && <Cart_Popup title={"added your product"} />}

                        {/* product img  */}
                        <Col lg={6}>

                            <div className="product_details_container">
                                <div className="show_other_img d-flex ">
                                    <div className="product_details_main_img">
                                        {
                                            productDetails.productSubImg.map((img, idx) => {
                                                return (
                                                    <img onClick={() => changeOnImg(img)} style={{ border: onImg == img ? "1px solid green" : "none" }} key={idx} src={img} alt="" />
                                                )
                                            })
                                        }
                                    </div>
                                    <div className="main_show_img">
                                        <img src={onImg || productDetails.productmainImg} alt="" />
                                    </div>
                                </div>
                            </div>

                        </Col>

                        {/* product details  */}

                        <Col lg={6}>

                            <div className="product_details_content">
                                <div className="product_all_details">
                                    <div className="product_name">
                                        <h2>{productDetails.productBrand}</h2>
                                        <h1>{productDetails.productName}</h1>
                                    </div>
                                    <div className="product_price">
                                        <p>Special price</p>
                                        <div className='product_price d-flex gap-2 items-center'><h2> ₹ ${productPrice} </h2><sup> ₹ {productDetails.productOldPrice} </sup> <h5>{productDetails.productDiscount}% Off</h5></div>
                                    </div>
                                    <div className="product_qty flex gap-2  items-center">
                                        <p onClick={decreament}><FaMinus /></p>
                                        <h6>{increaseQty}</h6>
                                        <p onClick={increament}><FaPlus /></p>
                                    </div>
                                    <div className="products_size flex items-center gap-3">
                                        <h6>Size : </h6>
                                        <span className='flex gap-3'>{productDetails.productSizes.map((item, idx) => (
                                            <p key={idx} className={`size_product ${select === item ? "change_size" : ""}`} onClick={() => HandleSize(item)}>{item}</p>
                                        ))}</span>
                                    </div>
                                    <div className="produt_offerc">
                                        <h3>Available offers</h3>
                                        <ul>
                                            {
                                                productDetails.productOffers.map((offer, idx) => {
                                                    return (
                                                        <li key={idx}>{offer}</li>
                                                    )
                                                })
                                            }
                                        </ul>
                                    </div>
                                    <div className="product_keyfeatures">
                                        <h3>Product Category</h3>
                                        <p><span>Product Category : </span>{productDetails.productCategory}</p>
                                        <p><span>Product Tags : </span>{productDetails.productTags}</p>
                                        <p><span>Product Wash Care : </span>{productDetails.productWashCare}</p>
                                    </div>
                                    <div className="add_to_cart_button">
                                        <button className='main_button' onClick={handleAddToCart}>Add To Cart</button>
                                        <button className='main_button' >Buy Now</button>
                                    </div>
                                </div>
                            </div>

                        </Col>


                    </div>
                    <PostReview />
                </Row>
            </Container>
        </>
    )
}

export default Product_Details